<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMP Exam Prep</title>
    <style>
        /* Basic CSS for functionality */
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 10px;
        }
        .score-display {
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        .controls {
            margin-bottom: 10px;
        }
        .question-area {
            margin-bottom: 20px;
        }
        .options-list {
            list-style: none;
            padding: 0;
        }
        .option-item {
            border: 1px solid #ccc;
            padding: 8px;
            margin-bottom: 5px;
            cursor: pointer;
        }
        .selected {
            background-color: lightblue;
        }
        .feedback-area {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #eee;
            background-color: #f9f9f9;
        }
        .explanation {
            margin-top: 10px;
            font-style: italic;
            color: #555;
        }
        .reference {
            margin-top: 5px;
            font-size: 0.9em;
            color: #777;
        }
        .results-container {
            margin-top: 30px;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .results-container h2 {
            text-align: center;
            margin-bottom: 15px;
        }
        .result-item {
            margin-bottom: 10px;
            padding: 10px;
            border-bottom: 1px dashed #eee;
        }
        .result-item p {
            margin: 5px 0;
        }
        .correct-answer {
            font-weight: bold;
            color: green;
        }
        .your-answer {
            color: blue;
        }
        #no-answer-message {
            color: red;
            display: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>PMP Exam Prep</h1>
        <p>Simulated Exam</p>
    </header>

    <div class="score-display" id="score-display">Score: 0</div>

    <div class="container">
        <div class="controls">
            <label><input type="checkbox" id="shuffle-questions"> Shuffle Questions</label>
            <label><input type="checkbox" id="shuffle-options"> Shuffle Options</label>
        </div>

        <div class="question-area">
            <p id="question-text"></p>
            <ul class="options-list" id="options-container"></ul>
        </div>

        <div class="feedback-area" id="feedback-container" style="display: none;">
            <p id="feedback-message"></p>
            <p class="explanation" id="explanation-text"></p>
            <p class="reference" id="reference-text"></p>
        </div>

        <p id="no-answer-message"></p>
        <button id="submit-button">Submit Answer</button>
        <button id="next-button" disabled>Next</button>
    </div>

    <div class="results-container" id="results-container">
        <h2>Final Results</h2>
        <div id="results-list">
            </div>
        <p id="final-score"></p>
        <p id="exam-completed-message" style="text-align: center; font-weight: bold; margin-top: 20px;">Exam Completed</p>
    </div>

    <script>
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackMessage = document.getElementById('feedback-message');
        const submitButton = document.getElementById('submit-button');
        const nextButton = document.getElementById('next-button');
        const shuffleQuestionsCheckbox = document.getElementById('shuffle-questions');
        const shuffleOptionsCheckbox = document.getElementById('shuffle-options');
        const explanationText = document.getElementById('explanation-text');
        const referenceText = document.getElementById('reference-text');
        const scoreDisplay = document.getElementById('score-display');
        const resultsContainer = document.getElementById('results-container');
        const resultsList = document.getElementById('results-list');
        const finalScoreDisplay = document.getElementById('final-score');
        const mainContainer = document.querySelector('.container');
        const examCompletedMessage = document.getElementById('exam-completed-message');
        const noAnswerMessage = document.getElementById('no-answer-message');

        let allQuestions = [
          {
            "category": "Project Initiation",
            "question": "Which of the following is the primary purpose of the Project Charter?",
            "options": [
              "To outline the detailed project schedule.",
              "To formally authorize a project or a phase.",
              "To define the project budget.",
              "To identify all project risks."
            ],
            "correctAnswerIndex": 1,
            "explanation": "The Project Charter formally authorizes the existence of a project and provides the project manager with the authority to apply organizational resources to project activities.",
            "reference": "PMBOK 6th Edition, Section 4.1"
          },
          {
            "category": "Project Planning",
            "question": "A project manager is developing the project management plan. Which of the following is NOT an output of the Develop Project Management Plan process?",
            "options": [
              "Project Management Plan",
              "Project Charter",
              "Team Charter",
              "Updates to the Project Documents"
            ],
            "correctAnswerIndex": 1,
            "explanation": "The Project Charter is an output of the Develop Project Charter process, which occurs during Project Initiation.",
            "reference": "PMBOK 6th Edition, Section 4.2"
          },
          {
            "category": "Project Execution",
            "question": "During project execution, a key stakeholder expresses concern about a deliverable that was already approved. What should the project manager do FIRST?",
            "options": [
              "Immediately rework the deliverable to satisfy the stakeholder.",
              "Inform the sponsor about the stakeholder's concerns.",
              "Review the stakeholder engagement plan and the change management plan.",
              "Hold a meeting with the project team to discuss the issue."
            ],
            "correctAnswerIndex": 2,
            "explanation": "The project manager should first consult the stakeholder engagement plan to understand the stakeholder's level of influence and interest, and the change management plan to follow the established process for handling such requests.",
            "reference": "PMBOK 6th Edition, Section 4.3 & 13.2"
          },
          {
            "category": "Project Monitoring and Controlling",
            "question": "Earned Value (EV) is $100, Planned Value (PV) is $120, and Actual Cost (AC) is $90. What is the Cost Variance (CV)?",
            "options": [
              "$10",
              "-$20",
              "$30",
              "-$30"
            ],
            "correctAnswerIndex": 0,
            "explanation": "Cost Variance (CV) = Earned Value (EV) - Actual Cost (AC). In this case, CV = $100 - $90 = $10. A positive CV indicates that the project is under budget.",
            "reference": "PMBOK 6th Edition, Section 7.4"
          },
          {
            "category": "Project Closure",
            "question": "Which of the following activities is typically performed during the Close Project or Phase process?",
            "options": [
              "Developing the project management plan.",
              "Creating the work breakdown structure.",
              "Finalizing all activities across all the Project Management Process Groups.",
              "Monitoring and controlling the project work."
            ],
            "correctAnswerIndex": 2,
            "explanation": "The Close Project or Phase process involves finalizing all activities across all the Project Management Process Groups to formally complete the project or phase.",
            "reference": "PMBOK 6th Edition, Section 4.6"
          }
        ];

        let currentQuestionIndex = 0;
        let currentQuestions = [];
        let shuffledQuestions = false;
        let shuffledOptions = false;
        let selectedAnswerIndex = null;
        let score = 0;
        let userAnswers = []; // To store the index of the user's selected answer for each question

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadQuestion() {
            if (currentQuestionIndex < currentQuestions.length) {
                const currentQuestion = currentQuestions[currentQuestionIndex];
                questionText.textContent = currentQuestion.question;
                optionsContainer.innerHTML = '';
                const options = shuffledOptions ? shuffleArray([...currentQuestion.options]) : [...currentQuestion.options];
                currentQuestion.shuffledOptionsOrder = options; // Store the shuffled order to map back later
                options.forEach((option, index) => {
                    const li = document.createElement('li');
                    li.classList.add('option-item');
                    li.textContent = option;
                    li.dataset.index = index; // Store the index in the shuffled array
                    li.addEventListener('click', selectOption);
                    optionsContainer.appendChild(li);
                });
                feedbackContainer.style.display = 'none';
                submitButton.disabled = false;
                nextButton.disabled = true;
                explanationText.textContent = '';
                referenceText.textContent = '';
                noAnswerMessage.style.display = 'none'; // Hide the no answer message when loading a new question
            } else {
                showFinalResults();
            }
        }

        function selectOption(event) {
            if (!submitButton.disabled) {
                const previouslySelected = document.querySelector('.option-item.selected');
                if (previouslySelected) {
                    previouslySelected.classList.remove('selected');
                }
                event.target.classList.add('selected');
                selectedAnswerIndex = parseInt(event.target.dataset.index);
                noAnswerMessage.style.display = 'none'; // Hide the no answer message when an option is selected
            }
        }

        function checkAnswer() {
            if (selectedAnswerIndex === null) {
                noAnswerMessage.textContent = "Please select an answer.";
                noAnswerMessage.style.display = 'block';
                return; // Stop the function if no answer is selected
            }

            const currentQuestion = currentQuestions[currentQuestionIndex];
            feedbackContainer.style.display = 'block';
            const originalCorrectIndex = currentQuestion.correctAnswerIndex;
            const selectedOptionText = currentQuestion.shuffledOptionsOrder[selectedAnswerIndex];
            const originalCorrectAnswer = currentQuestion.options[originalCorrectIndex];
            const isCorrect = selectedOptionText === originalCorrectAnswer;

            userAnswers[currentQuestionIndex] = selectedAnswerIndex; // Store the index in the shuffled options

            if (isCorrect) {
                feedbackMessage.textContent = "Correct!";
                score++;
                scoreDisplay.textContent = 'Score: ' + score;
            } else {
                feedbackMessage.textContent = "Incorrect.";
            }
            explanationText.textContent = currentQuestion.explanation;
            referenceText.textContent = `PMBOK Section: ${currentQuestion.reference}`;
            submitButton.disabled = true;
            if (currentQuestionIndex < currentQuestions.length - 1) {
                nextButton.disabled = false;
            }
            selectedAnswerIndex = null; // Reset after submitting
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function showFinalResults() {
            mainContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            resultsList.innerHTML = '';
            currentQuestions.forEach((question, index) => {
                const resultItem = document.createElement('div');
                resultItem.classList.add('result-item');
                const questionNumber = index + 1;
                resultItem.innerHTML = `<h3>Question ${questionNumber}: ${question.question}</h3>`;

                const originalCorrectAnswer = question.options[question.correctAnswerIndex];
                resultItem.innerHTML += `<p class="correct-answer">Correct Answer: ${originalCorrectAnswer}</p>`;

                if (userAnswers[index] !== undefined) {
                    const selectedOptionText = question.shuffledOptionsOrder[userAnswers[index]];
                    resultItem.innerHTML += `<p class="your-answer">Your Answer: ${selectedOptionText}</p>`;
                    if (selectedOptionText === originalCorrectAnswer) {
                        resultItem.classList.add('correct');
                    } else {
                        resultItem.classList.add('incorrect');
                    }
                } else {
                    resultItem.innerHTML += `<p class="your-answer">Your Answer: Not answered</p>`;
                }
                resultsList.appendChild(resultItem);
            });
            finalScoreDisplay.textContent = `Final Score: ${score} out of ${currentQuestions.length}`;
            examCompletedMessage.style.display = 'block'; // Ensure the message is visible
        }

        submitButton.addEventListener('click', checkAnswer);
        nextButton.addEventListener('click', nextQuestion);

        shuffleQuestionsCheckbox.addEventListener('change', () => {
            shuffledQuestions = shuffleQuestionsCheckbox.checked;
            currentQuestionIndex = 0;
            loadQuestions();
        });

        shuffleOptionsCheckbox.addEventListener('change', () => {
            shuffledOptions = shuffleOptionsCheckbox.checked;
            loadQuestion();
        });

        function loadQuestions() {
            currentQuestions = [...allQuestions]; // Create a copy

            if (shuffledQuestions) {
                currentQuestions = shuffleArray(currentQuestions);
            }
            userAnswers = new Array(currentQuestions.length).fill(null); // Reset user answers
            score = 0;
            scoreDisplay.textContent = 'Score: ' + score;
            currentQuestionIndex = 0;
            loadQuestion();
        }

        // Initialize
        loadQuestions();
        examCompletedMessage.style.display = 'none'; // Hide the message initially
    </script>

    <noscript>Please enable JavaScript to use this application.</noscript>
</body>
</html>
