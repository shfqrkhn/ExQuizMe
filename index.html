<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PMP Exam Simulator</title>
  <style>
    /* Basic Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: #333;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    main {
      flex: 1;
      padding: 1rem;
      max-width: 800px;
      width: 100%;
      margin: 1rem auto;
      background: #fff;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #app > div {
      margin-bottom: 1.5rem;
    }
    .question {
      margin-bottom: 2rem;
    }
    .questionOptions {
      list-style: none;
      padding: 0;
    }
    .questionOptions li {
      margin-bottom: 1rem;
    }
    .feedback {
      font-weight: bold;
      margin-top: 1rem;
    }
    /* Button Styles */
    button {
      background: #333;
      color: #fff;
      border: none;
      padding: 0.8rem 1.2rem;
      cursor: pointer;
      border-radius: 4px;
      font-size: 1rem;
    }
    button:hover {
      opacity: 0.9;
    }
    /* Responsive adjustments */
    @media (max-width: 600px) {
      main {
        padding: 0.5rem;
        margin: 0.5rem;
      }
    }
    /* Control Panel styling */
    #controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    #modeSelection label {
      margin-right: 1rem;
      font-weight: bold;
    }
    #chapterSelection label,
    #combinedOptions label {
      margin-right: 0.5rem;
      font-weight: bold;
    }
    select {
      padding: 0.5rem;
      font-size: 1rem;
    }
    /* Timer styling */
    #timerDisplay {
      font-weight: bold;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>PMP Exam Simulator</h1>
  </header>
  <main>
    <div id="app">
      <div id="controls">
        <!-- Exam Mode Selection -->
        <div id="modeSelection">
          <label>
            <input type="radio" name="examMode" value="chapter" checked>
            Chapter Mode
          </label>
          <label>
            <input type="radio" name="examMode" value="combined">
            Combined Mode
          </label>
        </div>
        <!-- Chapter Selection (for Chapter Mode) -->
        <div id="chapterSelection">
          <label for="chapterSelect">Select PMBOK Chapter:</label>
          <select id="chapterSelect"></select>
        </div>
        <!-- Combined Options (for Combined Mode) -->
        <div id="combinedOptions" style="display:none;">
          <label for="questionCountSelect">Select number of questions:</label>
          <select id="questionCountSelect">
            <option value="20">20</option>
            <option value="100">100</option>
            <option value="200">200</option>
          </select>
        </div>
      </div>

      <!-- Timer Display -->
      <div id="timerDisplay">
        Time Remaining: <span id="timeRemaining">00:00:00</span>
      </div>

      <!-- Question & Feedback Area -->
      <div id="questionContainer"></div>
      <button id="nextButton" style="display:none;">Next Question</button>
      <div id="feedback" class="feedback"></div>
    </div>
  </main>

  <script>
    /***** Exam Data: Easy-to-Fill Question Bank *****/
    /* 
       To add a new question, follow this template:
       
       {
         "question": "Your question here?",
         "options": [
           "Option 1",
           "Option 2",
           "Option 3",
           "Option 4"
         ],
         "correctIndex": [index of the correct option, 0-3],
         "explanation": "Brief explanation of the answer."
       }
       
       You can add new chapters or append questions to an existing chapter.
    */
    const examData = {
      "chapters": [
        {
          "name": "Chapter 1: Initiation",
          "questions": [
            {
              "question": "What is the primary purpose of a Project Charter?",
              "options": [
                "Define detailed project requirements",
                "Authorize the project and provide a high-level overview",
                "Outline the project schedule in detail",
                "Detail resource allocation"
              ],
              "correctIndex": 1,
              "explanation": "The Project Charter authorizes the project and provides a high-level view."
            },
            {
              "question": "What key document formally initiates a project?",
              "options": [
                "Project Charter",
                "Project Management Plan",
                "Risk Register",
                "Work Breakdown Structure"
              ],
              "correctIndex": 0,
              "explanation": "The Project Charter is the document that formally initiates a project."
            },
            {
              "question": "Which stakeholder is primarily responsible for approving the project charter?",
              "options": [
                "Project Manager",
                "Project Sponsor",
                "Team Member",
                "Customer"
              ],
              "correctIndex": 1,
              "explanation": "The Project Sponsor generally approves the project charter."
            },
            {
              "question": "What is usually included in a project charter?",
              "options": [
                "Detailed activity schedules",
                "High-level project objectives and scope",
                "Employee payroll details",
                "Detailed risk analysis"
              ],
              "correctIndex": 1,
              "explanation": "A project charter includes high-level objectives, scope, assumptions, and constraints."
            },
            {
              "question": "Who is often responsible for drafting the project charter?",
              "options": [
                "Project Manager",
                "Business Analyst",
                "Project Sponsor",
                "Quality Assurance Analyst"
              ],
              "correctIndex": 0,
              "explanation": "The Project Manager is typically responsible for drafting the project charter with input from stakeholders."
            },
            {
              "question": "What is a key benefit of having a project charter?",
              "options": [
                "Ensures detailed planning of every task",
                "Provides a clear project vision and authorization",
                "Reduces project costs immediately",
                "Guarantees stakeholder satisfaction"
              ],
              "correctIndex": 1,
              "explanation": "The charter sets a clear vision and officially authorizes the project."
            },
            {
              "question": "Which of the following best describes a stakeholder?",
              "options": [
                "Only the project manager is a stakeholder",
                "Individuals or organizations affected by the project",
                "Contractors only",
                "Shareholders exclusively"
              ],
              "correctIndex": 1,
              "explanation": "Stakeholders include any individual or group affected by the project."
            },
            {
              "question": "What does the initiation phase primarily aim to do?",
              "options": [
                "Plan detailed work schedules",
                "Define and authorize a new project or phase",
                "Execute project tasks",
                "Close out completed projects"
              ],
              "correctIndex": 1,
              "explanation": "Initiation is about defining and authorizing a project."
            },
            {
              "question": "Which document is essential before moving to detailed planning?",
              "options": [
                "Project Charter",
                "Communication Plan",
                "Expense Sheet",
                "Change Request"
              ],
              "correctIndex": 0,
              "explanation": "The Project Charter is required before detailed planning can begin."
            },
            {
              "question": "The initiation phase mainly focuses on:",
              "options": [
                "Establishing a detailed project timeline",
                "Defining project objectives and securing authority",
                "Allocating all resources",
                "Developing risk management strategies"
              ],
              "correctIndex": 1,
              "explanation": "It focuses on setting objectives and obtaining formal authorization."
            }
          ]
        },
        {
          "name": "Chapter 2: Planning",
          "questions": [
            {
              "question": "What is the primary objective of the project planning phase?",
              "options": [
                "Authorize the project",
                "Develop a comprehensive project management plan",
                "Execute project tasks",
                "Close the project"
              ],
              "correctIndex": 1,
              "explanation": "The planning phase centers on developing a detailed project management plan."
            },
            {
              "question": "Which plan outlines the schedule, resources, and cost estimates?",
              "options": [
                "Project Charter",
                "Project Management Plan",
                "Risk Register",
                "Quality Plan"
              ],
              "correctIndex": 1,
              "explanation": "The Project Management Plan includes details on schedule, scope, resources, and costs."
            },
            {
              "question": "What tool is commonly used to break down project work into manageable sections?",
              "options": [
                "Gantt Chart",
                "Work Breakdown Structure (WBS)",
                "Project Charter",
                "Issue Log"
              ],
              "correctIndex": 1,
              "explanation": "The WBS divides the project into smaller, manageable components."
            },
            {
              "question": "Which process involves identifying and documenting project risks?",
              "options": [
                "Risk Management Planning",
                "Quality Assurance",
                "Scope Definition",
                "Resource Allocation"
              ],
              "correctIndex": 0,
              "explanation": "Risk management planning is about identifying and mitigating risks."
            },
            {
              "question": "What is the purpose of a schedule baseline?",
              "options": [
                "Capture changes after project closure",
                "Establish a reference for project schedule performance",
                "Document project risks",
                "Outline stakeholder expectations"
              ],
              "correctIndex": 1,
              "explanation": "The schedule baseline provides a benchmark to track project progress."
            },
            {
              "question": "Which document outlines the allocation of resources and responsibilities?",
              "options": [
                "Resource Management Plan",
                "Communication Plan",
                "Project Charter",
                "Stakeholder Register"
              ],
              "correctIndex": 0,
              "explanation": "The Resource Management Plan details resource assignments and roles."
            },
            {
              "question": "A detailed budget developed during planning is known as:",
              "options": [
                "Project Charter",
                "Cost Baseline",
                "Risk Register",
                "Quality Plan"
              ],
              "correctIndex": 1,
              "explanation": "The Cost Baseline is the approved version of the project budget."
            },
            {
              "question": "What is the purpose of a communication plan in project planning?",
              "options": [
                "To establish how project information will be shared",
                "To assign roles and responsibilities",
                "To develop the project scope",
                "To schedule tasks"
              ],
              "correctIndex": 0,
              "explanation": "It ensures that project information is distributed in a timely and appropriate manner."
            },
            {
              "question": "Which planning tool visually shows project tasks over time?",
              "options": [
                "Scatter Diagram",
                "Gantt Chart",
                "Pareto Chart",
                "Fishbone Diagram"
              ],
              "correctIndex": 1,
              "explanation": "A Gantt Chart displays project tasks along a timeline."
            },
            {
              "question": "In project planning, a comprehensive risk register includes:",
              "options": [
                "Risks, their likelihood, impact, and mitigation strategies",
                "Only the identified risks",
                "Budget and resource allocation",
                "Project schedules and milestones"
              ],
              "correctIndex": 0,
              "explanation": "A risk register documents risks along with their probability, impact, and the planned responses."
            }
          ]
        }
      ]
    };

    /***** Global Variables *****/
    let currentIndex = 0;
    let timerInterval;
    let totalTime = 0;      // Total exam time in seconds
    let timeRemaining = 0;  // Remaining time in seconds
    let examMode = "chapter"; // "chapter" or "combined"
    let currentChapter = "";
    let combinedQuestions = []; // For Combined Mode questions
    let currentQuestion = null; // To store the current question (with shuffled choices)

    /***** Utility Functions *****/
    // Shuffle an array using the Fisher-Yates algorithm.
    function shuffleArray(array) {
      let newArray = array.slice();
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    // Shuffle answer choices for a question and update the correct answer index.
    function shuffleChoices(question) {
      if (!question.hasOwnProperty("shuffledOptions")) {
        let options = question.options.slice();
        for (let i = options.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [options[i], options[j]] = [options[j], options[i]];
        }
        question.shuffledOptions = options;
        const correctAnswer = question.options[question.correctIndex];
        question.shuffledCorrectIndex = question.shuffledOptions.findIndex(opt => opt === correctAnswer);
      }
      return question;
    }

    /***** Exam Mode Initialization Functions *****/
    // Populate the chapter selection dropdown.
    function populateChapters() {
      const chapterSelect = document.getElementById('chapterSelect');
      chapterSelect.innerHTML = "";
      if (examData?.chapters?.length) {
        examData.chapters.forEach(chapter => {
          const option = document.createElement('option');
          option.value = chapter.name;
          option.textContent = chapter.name;
          chapterSelect.appendChild(option);
        });
        // Set default chapter.
        chapterSelect.value = examData.chapters[0].name;
        currentChapter = examData.chapters[0].name;
      } else {
        document.getElementById('questionContainer').innerHTML =
          '<p>No chapters found in the exam data.</p>';
      }
    }

    // Prepare the combined exam by aggregating and shuffling questions from all chapters.
    function prepareCombinedExam() {
      let allQuestions = [];
      examData.chapters.forEach(chapter => {
        allQuestions = allQuestions.concat(chapter.questions);
      });
      allQuestions = shuffleArray(allQuestions);
      const questionCount = parseInt(document.getElementById('questionCountSelect').value);
      if (allQuestions.length > questionCount) {
        allQuestions = allQuestions.slice(0, questionCount);
      }
      allQuestions.forEach(q => {
        delete q.shuffledOptions;
        delete q.shuffledCorrectIndex;
      });
      combinedQuestions = allQuestions;
    }

    /***** Timer Functions *****/
    // Update the displayed timer in HH:MM:SS format.
    function updateTimerDisplay() {
      const hours = Math.floor(timeRemaining / 3600);
      const minutes = Math.floor((timeRemaining % 3600) / 60);
      const seconds = timeRemaining % 60;
      document.getElementById('timeRemaining').textContent =
        (hours < 10 ? "0" + hours : hours) + ":" +
        (minutes < 10 ? "0" + minutes : minutes) + ":" +
        (seconds < 10 ? "0" + seconds : seconds);
    }

    // End the exam when the timer runs out.
    function examTimeOver() {
      alert("Time's up! The exam will now end.");
      document.getElementById('questionContainer').innerHTML = "<p>Time's up! The exam is over.</p>";
      document.getElementById('feedback').textContent = "";
      document.getElementById('nextButton').style.display = "none";
      clearInterval(timerInterval);
    }

    // Start or restart the exam timer.
    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      let numberOfQuestions = 0;
      if (examMode === "chapter") {
        const chapter = examData.chapters.find(ch => ch.name === currentChapter);
        numberOfQuestions = chapter ? chapter.questions.length : 0;
      } else if (examMode === "combined") {
        numberOfQuestions = parseInt(document.getElementById('questionCountSelect').value);
      }
      totalTime = numberOfQuestions * 75;
      timeRemaining = totalTime;
      updateTimerDisplay();

      timerInterval = setInterval(() => {
        timeRemaining--;
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          timeRemaining = 0;
          updateTimerDisplay();
          examTimeOver();
        } else {
          updateTimerDisplay();
        }
      }, 1000);
    }

    /***** Question Display & Answer Checking *****/
    function showQuestion() {
      const questionContainer = document.getElementById('questionContainer');
      let q;
      if (examMode === "chapter") {
        const chapter = examData.chapters.find(ch => ch.name === currentChapter);
        if (!chapter || currentIndex >= chapter.questions.length) {
          questionContainer.innerHTML = '<p>You have completed all questions in this chapter!</p>';
          document.getElementById('nextButton').style.display = 'none';
          clearInterval(timerInterval);
          return;
        }
        q = chapter.questions[currentIndex];
      } else if (examMode === "combined") {
        if (!combinedQuestions || currentIndex >= combinedQuestions.length) {
          questionContainer.innerHTML = '<p>You have completed all questions in this exam!</p>';
          document.getElementById('nextButton').style.display = 'none';
          clearInterval(timerInterval);
          return;
        }
        q = combinedQuestions[currentIndex];
      }
      q = shuffleChoices(q);
      currentQuestion = q;

      const optionsHTML = q.shuffledOptions.map((option, i) => `
          <li>
            <label>
              <input type="radio" name="answer" value="${i}"> ${option}
            </label>
          </li>`).join('');

      questionContainer.innerHTML = `
        <div class="question">
          <p>${q.question}</p>
          <ul class="questionOptions">
            ${optionsHTML}
          </ul>
          <button onclick="checkAnswer()">Submit Answer</button>
        </div>
      `;
      document.getElementById('feedback').textContent = '';
      document.getElementById('nextButton').style.display = 'none';
    }

    function checkAnswer() {
      const selected = document.querySelector('input[name="answer"]:checked');
      const feedbackDiv = document.getElementById('feedback');
      if (!selected) {
        feedbackDiv.textContent = 'Please select an answer.';
        return;
      }
      const userAnswer = parseInt(selected.value, 10);
      if (userAnswer === currentQuestion.shuffledCorrectIndex) {
        feedbackDiv.textContent = 'Correct! ' + (currentQuestion.explanation || '');
      } else {
        feedbackDiv.textContent = 'Incorrect! ' + (currentQuestion.explanation || '');
      }
      document.getElementById('nextButton').style.display = 'block';
    }

    // Advance to the next question.
    document.getElementById('nextButton').addEventListener('click', () => {
      currentIndex++;
      showQuestion();
    });

    /***** Exam Mode & Control Handlers *****/
    function setupModeSelection() {
      const modeRadios = document.getElementsByName("examMode");
      modeRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
          examMode = e.target.value;
          currentIndex = 0;
          if (examMode === "chapter") {
            document.getElementById('chapterSelection').style.display = "block";
            document.getElementById('combinedOptions').style.display = "none";
            currentChapter = document.getElementById('chapterSelect').value;
          } else {
            document.getElementById('chapterSelection').style.display = "none";
            document.getElementById('combinedOptions').style.display = "block";
            prepareCombinedExam();
          }
          startTimer();
          showQuestion();
        });
      });
    }

    function setupChapterSelection() {
      document.getElementById('chapterSelect').addEventListener('change', e => {
        currentChapter = e.target.value;
        currentIndex = 0;
        startTimer();
        showQuestion();
      });
    }

    function setupCombinedOptions() {
      document.getElementById('questionCountSelect').addEventListener('change', e => {
        currentIndex = 0;
        prepareCombinedExam();
        startTimer();
        showQuestion();
      });
    }

    /***** Initialization *****/
    function initExam() {
      populateChapters();
      setupModeSelection();
      setupChapterSelection();
      setupCombinedOptions();
      examMode = document.querySelector('input[name="examMode"]:checked').value;
      currentChapter = document.getElementById('chapterSelect').value;
      currentIndex = 0;
      startTimer();
      showQuestion();
    }

    initExam();
  </script>
</body>
</html>
