<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Quiz Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .quiz-container { max-width: 800px; margin: 2rem auto; }
        .question-card { transition: all 0.3s ease; }
        .choice-btn { transition: transform 0.2s; }
        .choice-btn:hover { transform: translateY(-2px); }
        .progress-bar { transition: width 0.5s ease; }
        .correct { background-color: #d4edda!important; }
        .incorrect { background-color: #f8d7da!important; }
        .review-item { cursor: pointer; }
        .fade-in { animation: fadeIn 0.5s; }
        .score-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px 15px;
            text-align: center;
            min-width: 180px;
        }
        .progress-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .progress-label {
            font-weight: 500;
            color: #495057;
        }
        .explanation-box {
            background-color: #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <!-- File Upload Section -->
        <div id="uploadSection" class="text-center">
            <h2 class="mb-4">Load Quiz Questions</h2>
            <input type="file" id="jsonFile" class="form-control mb-3" accept=".json">
            <div id="fileError" class="text-danger"></div>
        </div>

        <!-- Quiz Interface -->
        <div id="quizInterface" class="d-none">
            <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                <h3 id="quizTopic" class="mb-0"></h3>
                <div class="score-display">
                    <div class="d-flex justify-content-between">
                        <span class="progress-label">Score:</span>
                        <span><strong id="currentScore">0</strong>/<span id="totalQuestions">0</span></span>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                        <span class="progress-label">Quiz Progress:</span>
                        <span><strong id="percentageScore">0</strong>%</span>
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="flex-grow-1">
                    <div class="progress mb-1">
                        <div id="progressBar" class="progress-bar" role="progressbar"></div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small>Question <span id="currentQuestionNum">1</span> of <span id="totalQuestionsDisplay">0</span></small>
                        <small id="timer" class="text-muted">Time left: 0s</small>
                    </div>
                </div>
            </div>
            
            <div id="questionContainer" class="question-card card p-4 mb-4"></div>
            <div id="explanationContainer" class="explanation-box d-none"></div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="d-none">
            <div class="card p-4">
                <h2 class="mb-4">Quiz Results</h2>
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-2">
                        <h4 class="mb-0">Score:</h4>
                        <h4 class="mb-0"><strong id="finalScore">0</strong>/<span id="finalTotalQuestions">0</span></h4>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <h4 class="mb-0">Quiz Progress:</h4>
                        <h4 class="mb-0"><strong id="finalPercentage">0</strong>%</h4>
                    </div>
                    <div class="progress mt-3" style="height: 25px;">
                        <div id="finalPercentageBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                </div>
                <button id="reviewBtn" class="btn btn-info mb-3 w-100">Review Questions</button>
                <button class="btn btn-primary w-100" onclick="location.reload()">Restart Quiz</button>
            </div>
        </div>

        <!-- Review Section -->
        <div id="reviewSection" class="d-none">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">Question Review</h2>
                <div class="score-display">
                    <div class="d-flex justify-content-between">
                        <span class="progress-label">Final Score:</span>
                        <span><strong id="reviewFinalScore">0</strong>/<span id="reviewTotalQuestions">0</span></span>
                    </div>
                </div>
            </div>
            <div id="reviewQuestions"></div>
            <button class="btn btn-primary mt-3 w-100" onclick="location.reload()">Restart Quiz</button>
        </div>
    </div>

    <script>
        class QuizManager {
            constructor() {
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.timer = null;
                this.timeLeft = 0;
                this.userAnswers = [];
                this.quizTopic = '';
            }

            loadQuestions(jsonData) {
                try {
                    this.quizTopic = jsonData.topic;
                    this.questions = jsonData.questions.sort(() => Math.random() - 0.5);
                    this.updateTotalQuestionsDisplay();
                } catch (error) {
                    throw new Error('Invalid JSON format');
                }
            }

            updateTotalQuestionsDisplay() {
                const total = this.questions.length;
                document.getElementById('totalQuestions').textContent = total;
                document.getElementById('totalQuestionsDisplay').textContent = total;
                document.getElementById('finalTotalQuestions').textContent = total;
                document.getElementById('reviewTotalQuestions').textContent = total;
            }

            startQuiz() {
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.userAnswers = [];
                document.getElementById('currentScore').textContent = 0;
                this.updatePercentageScore();
                this.showQuestion();
            }

            showQuestion() {
                const question = this.questions[this.currentQuestionIndex];
                this.timeLeft = question.time || 30;
                this.startTimer();
                this.updateProgress();
                this.renderQuestion(question);
                document.getElementById('currentQuestionNum').textContent = this.currentQuestionIndex + 1;
                document.getElementById('explanationContainer').classList.add('d-none');
            }

            startTimer() {
                if (this.timer) clearInterval(this.timer);
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    document.getElementById('timer').textContent = `Time left: ${this.timeLeft}s`;
                    if (this.timeLeft <= 0) this.handleTimeExpired();
                }, 1000);
            }

            handleAnswer(selectedIndex) {
                const question = this.questions[this.currentQuestionIndex];
                const isCorrect = selectedIndex === question.correctAnswer;
                
                this.userAnswers.push({
                    question: question.questionText,
                    selected: selectedIndex,
                    correct: question.correctAnswer,
                    explanation: question.explanation
                });

                if (isCorrect) {
                    this.score += 1;
                    document.getElementById('currentScore').textContent = this.score;
                    this.updatePercentageScore();
                }

                clearInterval(this.timer);
                this.showFeedback(isCorrect, question.explanation);
            }

            showFeedback(isCorrect, explanation) {
                const buttons = document.querySelectorAll('.choice-btn');
                buttons.forEach(btn => {
                    btn.disabled = true;
                    const index = Array.from(buttons).indexOf(btn);
                    btn.classList.add(index === this.questions[this.currentQuestionIndex].correctAnswer ? 'correct' : 'incorrect');
                });

                // Show explanation
                const explanationContainer = document.getElementById('explanationContainer');
                explanationContainer.innerHTML = `
                    <h5>Explanation:</h5>
                    <p>${explanation}</p>
                    <button class="btn btn-primary mt-2" onclick="quiz.nextQuestion()">Continue</button>
                `;
                explanationContainer.classList.remove('d-none');
            }

            updatePercentageScore() {
                const percentage = Math.round((this.score / this.questions.length) * 100);
                document.getElementById('percentageScore').textContent = percentage;
            }

            nextQuestion() {
                if (this.currentQuestionIndex < this.questions.length - 1) {
                    this.currentQuestionIndex++;
                    this.showQuestion();
                } else {
                    this.endQuiz();
                }
            }

            endQuiz() {
                document.getElementById('quizInterface').classList.add('d-none');
                document.getElementById('resultsSection').classList.remove('d-none');
                
                const totalQuestions = this.questions.length;
                const percentage = Math.round((this.score / totalQuestions) * 100);
                
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('reviewFinalScore').textContent = this.score;
                document.getElementById('finalPercentage').textContent = percentage;
                document.getElementById('finalPercentageBar').style.width = `${percentage}%`;
            }

            renderQuestion(question) {
                const container = document.getElementById('questionContainer');
                container.innerHTML = `
                    <h4 class="mb-4">${question.questionText}</h4>
                    <div class="row g-3">
                        ${question.choices.map((choice, index) => `
                            <div class="col-md-6">
                                <button onclick="quiz.handleAnswer(${index})" 
                                    class="choice-btn btn btn-outline-primary w-100 text-start p-3">
                                    ${String.fromCharCode(65 + index)}. ${choice}
                                </button>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            updateProgress() {
                const progress = ((this.currentQuestionIndex + 1) / this.questions.length) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
            }

            showReview() {
                document.getElementById('resultsSection').classList.add('d-none');
                document.getElementById('reviewSection').classList.remove('d-none');
                document.getElementById('reviewQuestions').innerHTML = this.userAnswers
                    .map((answer, index) => `
                        <div class="card mb-3 fade-in">
                            <div class="card-body">
                                <h5>Question ${index + 1}</h5>
                                <p>${this.questions[index].questionText}</p>
                                <p class="${answer.selected === answer.correct ? 'text-success' : 'text-danger'}">
                                    Your answer: ${String.fromCharCode(65 + answer.selected)}<br>
                                    Correct answer: ${String.fromCharCode(65 + answer.correct)}
                                </p>
                                <p class="text-muted">Explanation: ${answer.explanation}</p>
                            </div>
                        </div>
                    `).join('');
            }
        }

        const quiz = new QuizManager();

        // Event Listeners
        document.getElementById('jsonFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    quiz.loadQuestions(jsonData);
                    
                    document.getElementById('uploadSection').classList.add('d-none');
                    document.getElementById('quizInterface').classList.remove('d-none');
                    document.getElementById('quizTopic').textContent = jsonData.topic;
                    quiz.startQuiz();
                } catch (error) {
                    document.getElementById('fileError').textContent = 'Error loading JSON file: ' + error.message;
                }
            };
            
            reader.readAsText(file);
        });

        document.getElementById('reviewBtn').addEventListener('click', () => {
            quiz.showReview();
        });
    </script>
</body>
</html>
