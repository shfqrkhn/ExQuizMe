<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PMP Exam Simulator</title>
  <style>
    /* Basic Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: #333;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    main {
      flex: 1;
      padding: 1rem;
      max-width: 800px;
      width: 100%;
      margin: 1rem auto;
      background: #fff;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #app > div {
      margin-bottom: 1.5rem;
    }
    .question {
      margin-bottom: 2rem;
    }
    .questionOptions {
      list-style: none;
      padding: 0;
    }
    .questionOptions li {
      margin-bottom: 1rem;
    }
    .feedback {
      font-weight: bold;
      margin-top: 1rem;
    }
    /* Button Styles */
    button {
      background: #333;
      color: #fff;
      border: none;
      padding: 0.8rem 1.2rem;
      cursor: pointer;
      border-radius: 4px;
      font-size: 1rem;
    }
    button:hover {
      opacity: 0.9;
    }
    /* Responsive adjustments */
    @media (max-width: 600px) {
      main {
        padding: 0.5rem;
        margin: 0.5rem;
      }
    }
    /* Control Panel styling */
    #controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    #modeSelection label {
      margin-right: 1rem;
      font-weight: bold;
    }
    #chapterSelection label,
    #combinedOptions label {
      margin-right: 0.5rem;
      font-weight: bold;
    }
    select {
      padding: 0.5rem;
      font-size: 1rem;
    }
    /* Timer styling */
    #timerDisplay {
      font-weight: bold;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>PMP Exam Simulator</h1>
  </header>
  <main>
    <div id="app">
      <div id="controls">
        <!-- Exam Mode Selection -->
        <div id="modeSelection">
          <label>
            <input type="radio" name="examMode" value="chapter" checked>
            Chapter Mode
          </label>
          <label>
            <input type="radio" name="examMode" value="combined">
            Combined Mode
          </label>
        </div>
        <!-- Chapter Selection (for Chapter Mode) -->
        <div id="chapterSelection">
          <label for="chapterSelect">Select PMBOK Chapter:</label>
          <select id="chapterSelect"></select>
        </div>
        <!-- Combined Options (for Combined Mode) -->
        <div id="combinedOptions" style="display:none;">
          <label for="questionCountSelect">Select number of questions:</label>
          <select id="questionCountSelect">
            <option value="20">20</option>
            <option value="100">100</option>
            <option value="200">200</option>
          </select>
        </div>
      </div>

      <!-- Timer Display -->
      <div id="timerDisplay">
        Time Remaining: <span id="timeRemaining">00:00:00</span>
      </div>

      <!-- Question & Feedback Area -->
      <div id="questionContainer"></div>
      <button id="nextButton" style="display:none;">Next Question</button>
      <div id="feedback" class="feedback"></div>
    </div>
  </main>

  <script>
    /***** Embedded Exam Data *****/
    const examData = {
      "chapters": [
        {
          "name": "Chapter 1: Introduction",
          "questions": [
            {
              "question": "What is the primary purpose of the PMP exam?",
              "options": [
                "To test theoretical knowledge only",
                "To evaluate your practical project management skills by applying PMBOK guidelines",
                "To assess technical IT skills",
                "To refine general management theories"
              ],
              "correctIndex": 1,
              "explanation": "The PMP exam evaluates your ability to manage real-world project scenarios in line with PMBOK guidelines."
            },
            {
              "question": "Which document outlines the processes and knowledge areas used in project management?",
              "options": [
                "Project Charter",
                "PMBOK Guide",
                "Project Management Plan",
                "Risk Register"
              ],
              "correctIndex": 1,
              "explanation": "The PMBOK Guide outlines the processes and knowledge areas essential for project management."
            }
          ]
        },
        {
          "name": "Chapter 2: Planning",
          "questions": [
            {
              "question": "Which process group is primarily responsible for outlining the project schedule?",
              "options": [
                "Initiating",
                "Planning",
                "Executing",
                "Closing"
              ],
              "correctIndex": 1,
              "explanation": "Project scheduling and detailed planning are functions of the Planning process group."
            },
            {
              "question": "What is a key output of the Planning phase?",
              "options": [
                "Project Charter",
                "Project Schedule",
                "Status Report",
                "Contract Agreement"
              ],
              "correctIndex": 1,
              "explanation": "The project schedule is a key output during the planning process, detailing timelines and milestones."
            }
          ]
        }
        // You can add more chapters and questions as needed.
      ]
    };

    /***** Global Variables *****/
    let currentIndex = 0;
    let timerInterval;
    let totalTime = 0;      // Total exam time in seconds
    let timeRemaining = 0;  // Remaining time in seconds
    let examMode = "chapter"; // "chapter" or "combined"
    let currentChapter = "";
    let combinedQuestions = []; // To store questions for Combined Mode
    let currentQuestion = null; // The current question (with shuffled choices)

    /***** Utility Functions *****/
    // Shuffle an array using Fisher-Yates algorithm.
    function shuffleArray(array) {
      let newArray = array.slice();
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    // Shuffle answer choices for a question and update the correct answer index.
    function shuffleChoices(question) {
      if (!question.hasOwnProperty("shuffledOptions")) {
        let options = question.options.slice();
        for (let i = options.length - 1; i > 0; i--) {
          let j = Math.floor(Math.random() * (i + 1));
          [options[i], options[j]] = [options[j], options[i]];
        }
        question.shuffledOptions = options;
        const correctAnswer = question.options[question.correctIndex];
        question.shuffledCorrectIndex = question.shuffledOptions.findIndex(opt => opt === correctAnswer);
      }
      return question;
    }

    /***** Exam Mode Initialization Functions *****/
    // Populate the chapter selection dropdown.
    function populateChapters() {
      const chapterSelect = document.getElementById('chapterSelect');
      chapterSelect.innerHTML = "";
      if (examData?.chapters?.length) {
        examData.chapters.forEach(chapter => {
          const option = document.createElement('option');
          option.value = chapter.name;
          option.textContent = chapter.name;
          chapterSelect.appendChild(option);
        });
        // Set default chapter.
        chapterSelect.value = examData.chapters[0].name;
        currentChapter = examData.chapters[0].name;
      } else {
        document.getElementById('questionContainer').innerHTML =
          '<p>No chapters found in the exam data.</p>';
      }
    }

    // Prepare the combined exam by aggregating and shuffling questions.
    function prepareCombinedExam() {
      let allQuestions = [];
      examData.chapters.forEach(ch => {
        allQuestions = allQuestions.concat(ch.questions);
      });
      allQuestions = shuffleArray(allQuestions);
      const questionCount = parseInt(document.getElementById('questionCountSelect').value);
      if (allQuestions.length > questionCount) {
        allQuestions = allQuestions.slice(0, questionCount);
      }
      allQuestions.forEach(q => {
        delete q.shuffledOptions;
        delete q.shuffledCorrectIndex;
      });
      combinedQuestions = allQuestions;
    }

    /***** Timer Functions *****/
    // Update the displayed timer in HH:MM:SS format.
    function updateTimerDisplay() {
      const hours = Math.floor(timeRemaining / 3600);
      const minutes = Math.floor((timeRemaining % 3600) / 60);
      const seconds = timeRemaining % 60;
      document.getElementById('timeRemaining').textContent =
        (hours < 10 ? "0" : "") + hours + ":" +
        (minutes < 10 ? "0" : "") + minutes + ":" +
        (seconds < 10 ? "0" : "") + seconds;
    }

    // End the exam when time runs out.
    function examTimeOver() {
      alert("Time's up! The exam will now end.");
      document.getElementById('questionContainer').innerHTML =
        "<p>Time's up! The exam is over.</p>";
      document.getElementById('feedback').textContent = "";
      document.getElementById('nextButton').style.display = "none";
      clearInterval(timerInterval);
    }

    // Start or restart the exam timer.
    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      let numberOfQuestions = 0;
      if (examMode === "chapter") {
        const chapter = examData.chapters.find(ch => ch.name === currentChapter);
        numberOfQuestions = chapter ? chapter.questions.length : 0;
      } else if (examMode === "combined") {
        numberOfQuestions = parseInt(document.getElementById('questionCountSelect').value);
      }
      totalTime = numberOfQuestions * 75;
      timeRemaining = totalTime;
      updateTimerDisplay();

      timerInterval = setInterval(() => {
        timeRemaining--;
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          timeRemaining = 0;
          updateTimerDisplay();
          examTimeOver();
        } else {
          updateTimerDisplay();
        }
      }, 1000);
    }

    /***** Question Display & Answer Checking *****/
    function showQuestion() {
      const questionContainer = document.getElementById('questionContainer');
      let q;
      if (examMode === "chapter") {
        const chapter = examData.chapters.find(ch => ch.name === currentChapter);
        if (!chapter || currentIndex >= chapter.questions.length) {
          questionContainer.innerHTML = '<p>You have completed all questions in this chapter!</p>';
          document.getElementById('nextButton').style.display = 'none';
          clearInterval(timerInterval);
          return;
        }
        q = chapter.questions[currentIndex];
      } else if (examMode === "combined") {
        if (!combinedQuestions || currentIndex >= combinedQuestions.length) {
          questionContainer.innerHTML = '<p>You have completed all questions in this exam!</p>';
          document.getElementById('nextButton').style.display = 'none';
          clearInterval(timerInterval);
          return;
        }
        q = combinedQuestions[currentIndex];
      }
      q = shuffleChoices(q);
      currentQuestion = q;

      let optionsHTML = q.shuffledOptions.map((option, i) => `
          <li>
            <label>
              <input type="radio" name="answer" value="${i}"> ${option}
            </label>
          </li>`).join('');

      questionContainer.innerHTML = `
        <div class="question">
          <p>${q.question}</p>
          <ul class="questionOptions">
            ${optionsHTML}
          </ul>
          <button onclick="checkAnswer()">Submit Answer</button>
        </div>
      `;
      document.getElementById('feedback').textContent = '';
      document.getElementById('nextButton').style.display = 'none';
    }

    function checkAnswer() {
      const selected = document.querySelector('input[name="answer"]:checked');
      const feedbackDiv = document.getElementById('feedback');
      if (!selected) {
        feedbackDiv.textContent = 'Please select an answer.';
        return;
      }
      const userAnswer = parseInt(selected.value, 10);
      if (userAnswer === currentQuestion.shuffledCorrectIndex) {
        feedbackDiv.textContent = 'Correct! ' + (currentQuestion.explanation || '');
      } else {
        feedbackDiv.textContent = 'Incorrect! ' + (currentQuestion.explanation || '');
      }
      document.getElementById('nextButton').style.display = 'block';
    }

    // Advance to the next question.
    document.getElementById('nextButton').addEventListener('click', () => {
      currentIndex++;
      showQuestion();
    });

    /***** Exam Mode & Control Handlers *****/
    function setupModeSelection() {
      const modeRadios = document.getElementsByName("examMode");
      modeRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
          examMode = e.target.value;
          currentIndex = 0;
          if (examMode === "chapter") {
            document.getElementById('chapterSelection').style.display = "block";
            document.getElementById('combinedOptions').style.display = "none";
            currentChapter = document.getElementById('chapterSelect').value;
          } else {
            document.getElementById('chapterSelection').style.display = "none";
            document.getElementById('combinedOptions').style.display = "block";
            prepareCombinedExam();
          }
          startTimer();
          showQuestion();
        });
      });
    }

    function setupChapterSelection() {
      document.getElementById('chapterSelect').addEventListener('change', e => {
        currentChapter = e.target.value;
        currentIndex = 0;
        startTimer();
        showQuestion();
      });
    }

    function setupCombinedOptions() {
      document.getElementById('questionCountSelect').addEventListener('change', e => {
        currentIndex = 0;
        prepareCombinedExam();
        startTimer();
        showQuestion();
      });
    }

    /***** Initialization *****/
    function initExam() {
      populateChapters();
      setupModeSelection();
      setupChapterSelection();
      setupCombinedOptions();
      examMode = document.querySelector('input[name="examMode"]:checked').value;
      currentChapter = document.getElementById('chapterSelect').value;
      currentIndex = 0;
      startTimer();
      showQuestion();
    }

    initExam();
  </script>
</body>
</html>
